#!/bin/sh
lang="${1-de}"
lang="${lang%.txt}"
charset="${2}"
utf8="cat"
if test "${lang}" = "en"
then
	for c in src/iroffer*.c src/dinoex*.c
	do
		if test -f "${c}.en"
		then
			echo \
			mv -f "${c}.en" "${c}"
			mv -f "${c}.en" "${c}"
		fi
	done
	exit 0
fi
case "${charset}" in
u*)
	echo "utf-8 enabled ..."
	utf8="iconv -f latin1 -t utf-8"
	;;
esac
echo -n "parsing ... "
sed -e 's| |	|' en.txt > en.tmp
sed -e 's| |	|' "${lang}.txt" > "${lang}.tmp"
join -t '	' en.tmp "${lang}.tmp" |
sed -e 's|^[0-9]*|s|' -e 's|"$|"	|' |
awk -F '	' '
{ 
	if ( $2 == $3 )
		next
	print
}
' |
${utf8} |
sed -e 's|\\|\\\\|g' -e 's|\*|\\*|g' -e 's|\+|\\+|g' -e 's|\.|\\.|g' -e 's|\[|\\[|g' -e 's|\]|\\]|g' > "${lang}.sed"
rm -f en.tmp "${lang}.tmp"
echo "done"
for c in src/iroffer*.c src/dinoex*.c
do
	if test ! -f "${c}.en"
	then
		echo \
		cp -p "${c}" "${c}.en"
		cp -p "${c}" "${c}.en"
	fi
	sed -f "${lang}.sed" "${c}".en > "${c}.new"
	if diff -q "${c}" "${c}.new"
	then
		rm -f "${c}.new"
		continue
	fi
	echo \
	mv -f "${c}.new" "${c}"
	mv -f "${c}.new" "${c}"
done
# eof
